# terraform-aws-ecs-weighted-app

[![Lint Status](https://github.com/DNXLabs/terraform-aws-ecs-app/workflows/Lint/badge.svg)](https://github.com/DNXLabs/terraform-aws-ecs-weighted-app/actions)
[![LICENSE](https://img.shields.io/github/license/DNXLabs/terraform-aws-ecs-app)](https://github.com/DNXLabs/terraform-aws-ecs-weighted-app/blob/master/LICENSE)

## Requirements

| Name                                                                     | Version  |
| ------------------------------------------------------------------------ | -------- |
| <a name="requirement_terraform"></a> [terraform](#requirement_terraform) | >= 0.13  |
| <a name="requirement_aws"></a> [aws](#requirement_aws)                   | >= 4.0.0 |

## Providers

| Name                                                      | Version |
| --------------------------------------------------------- | ------- |
| <a name="provider_aws"></a> [aws](#provider_aws)          | 5.95.0  |
| <a name="provider_random"></a> [random](#provider_random) | 3.7.2   |

## Modules

No modules.

## Resources

| Name                                                                                                                                                                             | Type        |
| -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [aws_appautoscaling_policy.scale_cpu](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/appautoscaling_policy)                                         | resource    |
| [aws_appautoscaling_policy.scale_memory](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/appautoscaling_policy)                                      | resource    |
| [aws_appautoscaling_target.ecs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/appautoscaling_target)                                               | resource    |
| [aws_cloudwatch_event_rule.ecs_events](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_event_rule)                                        | resource    |
| [aws_cloudwatch_event_target.ecs_events](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_event_target)                                    | resource    |
| [aws_cloudwatch_log_group.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group)                                             | resource    |
| [aws_cloudwatch_log_group.ecs_events](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_group)                                          | resource    |
| [aws_cloudwatch_log_resource_policy.ecs_events](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_resource_policy)                      | resource    |
| [aws_cloudwatch_log_subscription_filter.log_subscription_filter](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_subscription_filter) | resource    |
| [aws_cloudwatch_metric_alarm.ecs_running_tasks](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_metric_alarm)                             | resource    |
| [aws_cloudwatch_metric_alarm.high_cpu_usage](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_metric_alarm)                                | resource    |
| [aws_cloudwatch_metric_alarm.min_healthy_tasks](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_metric_alarm)                             | resource    |
| [aws_codedeploy_app.ecs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codedeploy_app)                                                             | resource    |
| [aws_codedeploy_deployment_group.ecs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/codedeploy_deployment_group)                                   | resource    |
| [aws_ecs_service.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_service)                                                               | resource    |
| [aws_ecs_task_definition.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_task_definition)                                               | resource    |
| [aws_iam_role.codedeploy_service](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role)                                                          | resource    |
| [aws_iam_role_policy_attachment.codedeploy_service](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/iam_role_policy_attachment)                      | resource    |
| [aws_lb_listener_rule.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener_rule)                                                     | resource    |
| [aws_lb_listener_rule.green_auth_oidc](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener_rule)                                             | resource    |
| [aws_lb_listener_rule.path_redirects](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener_rule)                                              | resource    |
| [aws_lb_listener_rule.redirects](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_listener_rule)                                                   | resource    |
| [aws_lb_target_group.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lb_target_group)                                                       | resource    |
| [aws_route53_record.hostnames](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record)                                                       | resource    |
| [aws_route53_record.hostnames_internal](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/route53_record)                                              | resource    |
| [random_string.alb_prefix](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/string)                                                                | resource    |
| [aws_ecs_cluster.ecs_cluster](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/ecs_cluster)                                                        | data source |
| [aws_iam_account_alias.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_account_alias)                                                | data source |
| [aws_iam_policy_document.ecs_events](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/iam_policy_document)                                         | data source |
| [aws_lb.alb_selected](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/lb)                                                                         | data source |
| [aws_lb_listener.ecs](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/lb_listener)                                                                | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/region)                                                                      | data source |
| [aws_route53_zone.selected](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/route53_zone)                                                         | data source |

## Inputs

| Name                                                                                                                                                            | Description                                                                                                                                                                                                                                                            | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Default                            | Required |
| --------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------- | :------: |
| <a name="input_alarm_ecs_running_tasks_threshold"></a> [alarm_ecs_running_tasks_threshold](#input_alarm_ecs_running_tasks_threshold)                            | Alarm when the number of ecs service running tasks is lower than a certain value. CloudWatch Container Insights must be enabled for the cluster.                                                                                                                       | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `0`                                |    no    |
| <a name="input_alarm_evaluation_periods"></a> [alarm_evaluation_periods](#input_alarm_evaluation_periods)                                                       | The number of minutes the alarm must be below the threshold before entering the alarm state.                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"2"`                              |    no    |
| <a name="input_alarm_high_cpu_usage_above"></a> [alarm_high_cpu_usage_above](#input_alarm_high_cpu_usage_above)                                                 | Alarm when CPU is above a certain value (use 0 to disable this alarm)                                                                                                                                                                                                  | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `80`                               |    no    |
| <a name="input_alarm_min_healthy_tasks"></a> [alarm_min_healthy_tasks](#input_alarm_min_healthy_tasks)                                                          | Alarm when the number of healthy tasks is less than this number (use 0 to disable this alarm)                                                                                                                                                                          | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `2`                                |    no    |
| <a name="input_alarm_prefix"></a> [alarm_prefix](#input_alarm_prefix)                                                                                           | String prefix for cloudwatch alarms. (Optional)                                                                                                                                                                                                                        | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"alarm"`                          |    no    |
| <a name="input_alarm_sns_topics"></a> [alarm_sns_topics](#input_alarm_sns_topics)                                                                               | Alarm topics to create and alert on ECS service metrics. Leaving empty disables all alarms.                                                                                                                                                                            | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `[]`                               |    no    |
| <a name="input_alb_dns_name"></a> [alb_dns_name](#input_alb_dns_name)                                                                                           | ALB DNS Name                                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_alb_listener_https_arn"></a> [alb_listener_https_arn](#input_alb_listener_https_arn)                                                             | ALB HTTPS Listener created by ECS cluster module                                                                                                                                                                                                                       | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a                                |   yes    |
| <a name="input_alb_name"></a> [alb_name](#input_alb_name)                                                                                                       | ALB name - Required if it is an internal one                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_alb_only"></a> [alb_only](#input_alb_only)                                                                                                       | Whether to deploy only an alb and no cloudFront or not with the cluster                                                                                                                                                                                                | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`                            |    no    |
| <a name="input_alb_priority"></a> [alb_priority](#input_alb_priority)                                                                                           | priority rules ALB (leave 0 to let terraform calculate)                                                                                                                                                                                                                | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `0`                                |    no    |
| <a name="input_auth_oidc_authorization_endpoint"></a> [auth_oidc_authorization_endpoint](#input_auth_oidc_authorization_endpoint)                               | Authorization endpoint for OIDC (Google: https://accounts.google.com/o/oauth2/v2/auth)                                                                                                                                                                                 | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_auth_oidc_client_id"></a> [auth_oidc_client_id](#input_auth_oidc_client_id)                                                                      | Client ID for OIDC authentication                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_auth_oidc_client_secret"></a> [auth_oidc_client_secret](#input_auth_oidc_client_secret)                                                          | Client Secret for OIDC authentication                                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_auth_oidc_enabled"></a> [auth_oidc_enabled](#input_auth_oidc_enabled)                                                                            | Enables OIDC-authenticated listener rule                                                                                                                                                                                                                               | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`                            |    no    |
| <a name="input_auth_oidc_hostnames"></a> [auth_oidc_hostnames](#input_auth_oidc_hostnames)                                                                      | List of hostnames to use as a condition to authenticate with OIDC                                                                                                                                                                                                      | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `[]`                               |    no    |
| <a name="input_auth_oidc_issuer"></a> [auth_oidc_issuer](#input_auth_oidc_issuer)                                                                               | Issuer URL for OIDC authentication (Google: https://accounts.google.com)                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_auth_oidc_paths"></a> [auth_oidc_paths](#input_auth_oidc_paths)                                                                                  | List of paths to use as a condition to authenticate (example: ['/admin*'])                                                                                                                                                                                             | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `[]`                               |    no    |
| <a name="input_auth_oidc_session_timeout"></a> [auth_oidc_session_timeout](#input_auth_oidc_session_timeout)                                                    | Session timeout for OIDC authentication (default 12 hours)                                                                                                                                                                                                             | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `43200`                            |    no    |
| <a name="input_auth_oidc_token_endpoint"></a> [auth_oidc_token_endpoint](#input_auth_oidc_token_endpoint)                                                       | Token Endpoint URL for OIDC authentication (Google: https://oauth2.googleapis.com/token)                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_auth_oidc_user_info_endpoint"></a> [auth_oidc_user_info_endpoint](#input_auth_oidc_user_info_endpoint)                                           | User Info Endpoint URL for OIDC authentication (Google: https://openidconnect.googleapis.com/v1/userinfo)                                                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_autoscaling_custom"></a> [autoscaling_custom](#input_autoscaling_custom)                                                                         | Set one or more app autoscaling by customized metric                                                                                                                                                                                                                   | <pre>list(object({<br/> name = string<br/> scale_in_cooldown = number<br/> scale_out_cooldown = number<br/> target_value = number<br/> metric_name = string<br/> namespace = string<br/> statistic = string<br/> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `[]`                               |    no    |
| <a name="input_autoscaling_max_prod"></a> [autoscaling_max_prod](#input_autoscaling_max_prod)                                                                   | Max number of containers to scale with autoscaling                                                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"1"`                              |    no    |
| <a name="input_autoscaling_min_prod"></a> [autoscaling_min_prod](#input_autoscaling_min_prod)                                                                   | Min number of containers to scale with autoscaling                                                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"1"`                              |    no    |
| <a name="input_cluster_name"></a> [cluster_name](#input_cluster_name)                                                                                           | Name of existing ECS Cluster to deploy this app to                                                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a                                |   yes    |
| <a name="input_codedeploy_deployment_config_name"></a> [codedeploy_deployment_config_name](#input_codedeploy_deployment_config_name)                            | Specifies the deployment configuration for CodeDeploy                                                                                                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"CodeDeployDefault.ECSAllAtOnce"` |    no    |
| <a name="input_codedeploy_role_arn"></a> [codedeploy_role_arn](#input_codedeploy_role_arn)                                                                      | Existing IAM CodeDeploy role ARN created by ECS cluster module                                                                                                                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `null`                             |    no    |
| <a name="input_codedeploy_wait_time_for_cutover"></a> [codedeploy_wait_time_for_cutover](#input_codedeploy_wait_time_for_cutover)                               | Time in minutes to route the traffic to the new application deployment                                                                                                                                                                                                 | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `0`                                |    no    |
| <a name="input_codedeploy_wait_time_for_termination"></a> [codedeploy_wait_time_for_termination](#input_codedeploy_wait_time_for_termination)                   | Time in minutes to terminate the new deployment                                                                                                                                                                                                                        | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `0`                                |    no    |
| <a name="input_compat_keep_target_group_naming"></a> [compat_keep_target_group_naming](#input_compat_keep_target_group_naming)                                  | Keeps old naming convention for target groups to avoid recreation of resource in production environments                                                                                                                                                               | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`                            |    no    |
| <a name="input_create_iam_codedeployrole"></a> [create_iam_codedeployrole](#input_create_iam_codedeployrole)                                                    | Create Codedeploy IAM Role for ECS or not.                                                                                                                                                                                                                             | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `true`                             |    no    |
| <a name="input_deployment_controller"></a> [deployment_controller](#input_deployment_controller)                                                                | Type of deployment controller. Valid values: CODE_DEPLOY, ECS, EXTERNAL.                                                                                                                                                                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"CODE_DEPLOY"`                    |    no    |
| <a name="input_dynamic_stickiness"></a> [dynamic_stickiness](#input_dynamic_stickiness)                                                                         | Target Group stickiness. Used in dynamic block.                                                                                                                                                                                                                        | `any`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | `[]`                               |    no    |
| <a name="input_ecs_service_capacity_provider_strategy"></a> [ecs_service_capacity_provider_strategy](#input_ecs_service_capacity_provider_strategy)             | (Optional) The capacity provider strategy to use for the service. Can be one or more. These can be updated without destroying and recreating the service only if set to [] and not changing from 0 capacity_provider_strategy blocks to greater than 0, or vice versa. | `list(map(string))`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | <pre>[<br/> {}<br/>]</pre>         |    no    |
| <a name="input_efs_mapping"></a> [efs_mapping](#input_efs_mapping)                                                                                              | A map of efs volume ids and paths to mount into the default task definition                                                                                                                                                                                            | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `{}`                               |    no    |
| <a name="input_enable_schedule"></a> [enable_schedule](#input_enable_schedule)                                                                                  | Enables schedule to shut down and start up instances outside business hours.                                                                                                                                                                                           | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`                            |    no    |
| <a name="input_enable_schedule_prod_1"></a> [enable_schedule_prod_1](#input_enable_schedule_prod_1)                                                             | enable / disable schedule on prod                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `false`                            |    no    |
| <a name="input_enable_schedule_prod_2"></a> [enable_schedule_prod_2](#input_enable_schedule_prod_2)                                                             | enable / disable schedule on prod                                                                                                                                                                                                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `false`                            |    no    |
| <a name="input_fargate_spot"></a> [fargate_spot](#input_fargate_spot)                                                                                           | Set true to use FARGATE_SPOT capacity provider by default (only when launch_type=FARGATE)                                                                                                                                                                              | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`                            |    no    |
| <a name="input_hosted_zone"></a> [hosted_zone](#input_hosted_zone)                                                                                              | Hosted Zone to create DNS record for this app                                                                                                                                                                                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_hosted_zone_id"></a> [hosted_zone_id](#input_hosted_zone_id)                                                                                     | Hosted Zone ID to create DNS record for this app (use this to avoid data lookup when using `hosted_zone`)                                                                                                                                                              | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_hosted_zone_is_internal"></a> [hosted_zone_is_internal](#input_hosted_zone_is_internal)                                                          | Set true in case the hosted zone is in an internal VPC, otherwise false                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"false"`                          |    no    |
| <a name="input_hostname_create"></a> [hostname_create](#input_hostname_create)                                                                                  | Optional parameter to create or not a Route53 record                                                                                                                                                                                                                   | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`                            |    no    |
| <a name="input_hostname_redirects"></a> [hostname_redirects](#input_hostname_redirects)                                                                         | List of hostnames to redirect to the main one, comma-separated                                                                                                                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_hostnames"></a> [hostnames](#input_hostnames)                                                                                                    | List of hostnames to create listerner rule and optionally, DNS records for this app                                                                                                                                                                                    | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `[]`                               |    no    |
| <a name="input_http_header"></a> [http_header](#input_http_header)                                                                                              | Header to use on listerner rule with name e values                                                                                                                                                                                                                     | `list(any)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `[]`                               |    no    |
| <a name="input_launch_type"></a> [launch_type](#input_launch_type)                                                                                              | The launch type on which to run your service. The valid values are EC2 and FARGATE. Defaults to EC2.                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"FARGATE"`                        |    no    |
| <a name="input_log_subscription_filter_destination_arn"></a> [log_subscription_filter_destination_arn](#input_log_subscription_filter_destination_arn)          | n/a                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_log_subscription_filter_enabled"></a> [log_subscription_filter_enabled](#input_log_subscription_filter_enabled)                                  | n/a                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `false`                            |    no    |
| <a name="input_log_subscription_filter_filter_pattern"></a> [log_subscription_filter_filter_pattern](#input_log_subscription_filter_filter_pattern)             | n/a                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_log_subscription_filter_role_arn"></a> [log_subscription_filter_role_arn](#input_log_subscription_filter_role_arn)                               | n/a                                                                                                                                                                                                                                                                    | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_network_mode"></a> [network_mode](#input_network_mode)                                                                                           | The Docker networking mode to use for the containers in the task. The valid values are none, bridge, awsvpc, and host. (REQUIRED IF 'LAUCH_TYPE' IS FARGATE)                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `null`                             |    no    |
| <a name="input_ordered_placement_strategy"></a> [ordered_placement_strategy](#input_ordered_placement_strategy)                                                 | Service level strategy rules that are taken into consideration during task placement. List from top to bottom in order of precedence. The maximum number of ordered_placement_strategy blocks is 5.                                                                    | <pre>list(object({<br/> field = string<br/> type = string<br/> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `[]`                               |    no    |
| <a name="input_paths"></a> [paths](#input_paths)                                                                                                                | List of paths to use on listener rule (example: ['/*'])                                                                                                                                                                                                                | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `[]`                               |    no    |
| <a name="input_placement_constraints"></a> [placement_constraints](#input_placement_constraints)                                                                | Rules that are taken into consideration during task placement. Maximum number of placement_constraints is 10.                                                                                                                                                          | <pre>list(object({<br/> type = string<br/> expression = string<br/> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `[]`                               |    no    |
| <a name="input_redirects"></a> [redirects](#input_redirects)                                                                                                    | Map of path redirects to add to the listener                                                                                                                                                                                                                           | `map(any)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `{}`                               |    no    |
| <a name="input_schedule_cron_start"></a> [schedule_cron_start](#input_schedule_cron_start)                                                                      | Cron expression to define when to trigger a start of the auto-scaling group. E.g. 'cron(00 21 ? _ SUN-THU _)' to start at 8am UTC time.                                                                                                                                | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_schedule_cron_start_prod_1"></a> [schedule_cron_start_prod_1](#input_schedule_cron_start_prod_1)                                                 | Cron expression to define when to trigger a stop of the auto-scaling group. E.g. 'cron(00 09 ? _ MON-FRI _)' to start at 8am UTC time                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_schedule_cron_start_prod_2"></a> [schedule_cron_start_prod_2](#input_schedule_cron_start_prod_2)                                                 | Cron expression to define when to trigger a stop of the auto-scaling group. E.g. 'cron(00 09 ? _ MON-FRI _)' to start at 8am UTC time                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_schedule_cron_stop"></a> [schedule_cron_stop](#input_schedule_cron_stop)                                                                         | Cron expression to define when to trigger a stop of the auto-scaling group. E.g. 'cron(00 09 ? _ MON-FRI _)' to start at 8am UTC time                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_schedule_cron_stop_prod_1"></a> [schedule_cron_stop_prod_1](#input_schedule_cron_stop_prod_1)                                                    | Cron expression to define when to trigger a stop of the auto-scaling group. E.g. 'cron(00 09 ? _ MON-FRI _)' to start at 8am UTC time                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_schedule_cron_stop_prod_2"></a> [schedule_cron_stop_prod_2](#input_schedule_cron_stop_prod_2)                                                    | Cron expression to define when to trigger a stop of the auto-scaling group. E.g. 'cron(00 09 ? _ MON-FRI _)' to start at 8am UTC time                                                                                                                                  | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_security_groups"></a> [security_groups](#input_security_groups)                                                                                  | The security groups associated with the task or service                                                                                                                                                                                                                | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                             |    no    |
| <a name="input_service_deployment_maximum_percent"></a> [service_deployment_maximum_percent](#input_service_deployment_maximum_percent)                         | Maximum percentage of tasks to run during deployments                                                                                                                                                                                                                  | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `200`                              |    no    |
| <a name="input_service_deployment_minimum_healthy_percent"></a> [service_deployment_minimum_healthy_percent](#input_service_deployment_minimum_healthy_percent) | Minimum healthy percentage during deployments                                                                                                                                                                                                                          | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `100`                              |    no    |
| <a name="input_service_desired_count"></a> [service_desired_count](#input_service_desired_count)                                                                | Desired count for this service (for use when auto scaling is disabled)                                                                                                                                                                                                 | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `1`                                |    no    |
| <a name="input_service_health_check_grace_period_seconds"></a> [service_health_check_grace_period_seconds](#input_service_health_check_grace_period_seconds)    | Time until your container starts serving requests                                                                                                                                                                                                                      | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `0`                                |    no    |
| <a name="input_service_role_arn"></a> [service_role_arn](#input_service_role_arn)                                                                               | Existing service role ARN created by ECS cluster module                                                                                                                                                                                                                | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a                                |   yes    |
| <a name="input_services"></a> [services](#input_services)                                                                                                       | n/a                                                                                                                                                                                                                                                                    | <pre>list(object({<br/> name = string<br/> port = optional(number, 80)<br/> container_port = optional(number, 8080)<br/> protocol = optional(string, "HTTP")<br/> healthcheck_path = optional(string, "/")<br/> healthcheck_interval = optional(string, "10")<br/> healthy_threshold = optional(number, 3)<br/> unhealthy_threshold = optional(number, 3)<br/> healthcheck_timeout = optional(number, 5)<br/> healthcheck_matcher = optional(string, "200")<br/> target_group_weight = optional(number, 100)<br/> desired_count = optional(number, 2)<br/> deployment_controller = optional(string, "ECS")<br/> cloudwatch_logs_retention = optional(number, 120)<br/> cloudwatch_logs_export = optional(bool, false)<br/> image = optional(string, "")<br/> log_subscription_filter_enabled = optional(string, false)<br/> autoscaling_cpu = optional(bool, false)<br/> autoscaling_memory = optional(bool, false)<br/> autoscaling_max = optional(number, 4)<br/> autoscaling_min = optional(number, 1)<br/> autoscaling_target_cpu = optional(number, 50)<br/> autoscaling_target_memory = optional(number, 90)<br/> autoscaling_scale_in_cooldown = optional(number, 300)<br/> autoscaling_scale_out_cooldown = optional(number, 300)<br/> memory = optional(number, 1024)<br/> cpu = optional(number, 512)<br/> # paths = optional(list(string), [])<br/> # hostnames = optional(list(string), [])<br/> # source_ips = optional(list(string), [])<br/> }))</pre> | n/a                                |   yes    |
| <a name="input_source_ips"></a> [source_ips](#input_source_ips)                                                                                                 | List of source ip to use on listerner rule                                                                                                                                                                                                                             | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `[]`                               |    no    |
| <a name="input_ssm_variables"></a> [ssm_variables](#input_ssm_variables)                                                                                        | Map of variables and SSM locations to add to the task definition                                                                                                                                                                                                       | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `{}`                               |    no    |
| <a name="input_static_variables"></a> [static_variables](#input_static_variables)                                                                               | Map of variables and static values to add to the task definition                                                                                                                                                                                                       | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `{}`                               |    no    |
| <a name="input_subnets"></a> [subnets](#input_subnets)                                                                                                          | The subnets associated with the task or service. (REQUIRED IF var.launch_type IS FARGATE)                                                                                                                                                                              | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `null`                             |    no    |
| <a name="input_task_definition_arn"></a> [task_definition_arn](#input_task_definition_arn)                                                                      | Task definition to use for this service (optional)                                                                                                                                                                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `""`                               |    no    |
| <a name="input_task_role_arn"></a> [task_role_arn](#input_task_role_arn)                                                                                        | Existing task role ARN created by ECS cluster module                                                                                                                                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a                                |   yes    |
| <a name="input_ulimits"></a> [ulimits](#input_ulimits)                                                                                                          | Container ulimit settings. This is a list of maps, where each map should contain "name", "hardLimit" and "softLimit"                                                                                                                                                   | <pre>list(object({<br/> name = string<br/> hardLimit = number<br/> softLimit = number<br/> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `null`                             |    no    |
| <a name="input_vpc_id"></a> [vpc_id](#input_vpc_id)                                                                                                             | VPC ID to deploy this app to                                                                                                                                                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a                                |   yes    |

## Outputs

No outputs.
